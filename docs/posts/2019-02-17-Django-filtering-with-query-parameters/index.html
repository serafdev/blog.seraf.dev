<!DOCTYPE html><html domain="serafdev.github.io" lang="en"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="default-src 'self';object-src 'none';script-src 'self' 'sha256-Ky9qZOPnMhQV/s7Fdb9TYAOfU4KtWNqCZaFK8tSzXa0=';style-src 'unsafe-inline';img-src 'self' data:" http-equiv="Content-Security-Policy"><link href="/img/favicon/favicon-192x192.png?hash=2089033c93" rel="icon" type="image/png"><meta content="#f9c412" name="theme-color"><meta content="max-snippet:-1, max-image-preview: large, max-video-preview: -1" name="robots"><title>Django Filtering</title><meta content="Django Filtering" property="og:title"><meta content="This is a post on My Blog about agile frameworks." name="description"><meta content="This is a post on My Blog about agile frameworks." property="og:description"><meta content="summary_large_image" name="twitter:card"><meta content="@@serafdev" name="twitter:site"><meta content="@@serafdev" name="twitter:creator"><link href="https://serafdev.github.io/posts/2019-02-17-Django-filtering-with-query-parameters/" rel="canonical"><meta content="no-referrer-when-downgrade" name="referrer"><link href="/feed/feed.xml" rel="alternate" type="application/atom+xml" title="Fares' Blog"><link href="/" rel="preconnect" crossorigin=""><script async="" defer="" src="/js/min.js?hash=7d145181a5"></script><script csp-hash="sha256-Ky9qZOPnMhQV/s7Fdb9TYAOfU4KtWNqCZaFK8tSzXa0=">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>:root{--primary: #f9c412;--primary-dark: #E7BF60;--main-width: calc(100vw - 3em)}main img{content-visibility:auto}header nav{position:fixed;padding:.375em 1.5em;background:rgba(255,255,255,.9);font-weight:200;text-align:right}@media (min-width:37.5em){:root{--main-width: calc(37.5em - 3em)}}dialog,share-widget{position:fixed;opacity:.9}share-widget{right:20px;bottom:20px}share-widget div{width:30px;height:30px;background-image:url(/img/share.svg);background-repeat:no-repeat;background-position:center}.apple share-widget div{background-image:url(/img/share-apple.svg)}body,share-widget button{margin:0}share-widget button:active{transform:scale(1.2)}dialog{background-color:#8dff80}header aside{font-style:italic}#nav{z-index:2;position:relative}#reading-progress,header nav{z-index:1;width:100vw;left:0;top:0}#reading-progress{background-color:var(--primary);position:absolute;bottom:0;transform:translate(-100vw,0);will-change:transform;pointer-events:none}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:100;src:url(/fonts/Inter-Thin.woff2) format("woff2"),url(/fonts/Inter-Thin.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:100;src:url(/fonts/Inter-ThinItalic.woff2) format("woff2"),url(/fonts/Inter-ThinItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:200;src:url(/fonts/Inter-ExtraLight.woff2) format("woff2"),url(/fonts/Inter-ExtraLight.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:200;src:url(/fonts/Inter-ExtraLightItalic.woff2) format("woff2"),url(/fonts/Inter-ExtraLightItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:300;src:url(/fonts/Inter-Light.woff2) format("woff2"),url(/fonts/Inter-Light.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:300;src:url(/fonts/Inter-LightItalic.woff2) format("woff2"),url(/fonts/Inter-LightItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:400;src:url(/fonts/Inter-Regular.woff2) format("woff2"),url(/fonts/Inter-Regular.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:400;src:url(/fonts/Inter-Italic.woff2) format("woff2"),url(/fonts/Inter-Italic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:500;src:url(/fonts/Inter-Medium.woff2) format("woff2"),url(/fonts/Inter-Medium.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:500;src:url(/fonts/Inter-MediumItalic.woff2) format("woff2"),url(/fonts/Inter-MediumItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:600;src:url(/fonts/Inter-SemiBold.woff2) format("woff2"),url(/fonts/Inter-SemiBold.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:600;src:url(/fonts/Inter-SemiBoldItalic.woff2) format("woff2"),url(/fonts/Inter-SemiBoldItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:700;src:url(/fonts/Inter-Bold.woff2) format("woff2"),url(/fonts/Inter-Bold.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:700;src:url(/fonts/Inter-BoldItalic.woff2) format("woff2"),url(/fonts/Inter-BoldItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:800;src:url(/fonts/Inter-ExtraBold.woff2) format("woff2"),url(/fonts/Inter-ExtraBold.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:800;src:url(/fonts/Inter-ExtraBoldItalic.woff2) format("woff2"),url(/fonts/Inter-ExtraBoldItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:normal;font-weight:900;src:url(/fonts/Inter-Black.woff2) format("woff2"),url(/fonts/Inter-Black.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI';font-style:italic;font-weight:900;src:url(/fonts/Inter-BlackItalic.woff2) format("woff2"),url(/fonts/Inter-BlackItalic.woff) format("woff")}@font-face{font-display:swap;font-family:'Inter UI var alt';font-weight:100 900;font-style:normal;font-named-instance:'Regular';src:url(/fonts/Inter-roman.var.woff2) format("woff2")}@font-face{font-display:swap;font-family:'Inter UI var alt';font-weight:100 900;font-style:italic;font-named-instance:'Italic';src:url(/fonts/Inter-italic.var.woff2) format("woff2")}button,html{line-height:1.15}html{-webkit-text-size-adjust:100%}h1{font-size:3em;line-height:1.25;margin:.67em 0 .5em;font-size:2.074rem;line-height:2.4rem;margin-bottom:1.36rem}a{background-color:transparent;color:#f9c412;text-decoration:none;color:var(--primary)}img{border-style:none;max-width:100%;height:auto;margin:0 auto}button{font-family:inherit;font-size:100%;overflow:visible;text-transform:none}[type=button],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}summary{display:list-item}h4{font-size:1.5em;margin-bottom:1em;line-height:1.5em;line-height:1.6rem;margin-bottom:1.36rem;font-size:1.2rem}body,p,pre{font-size:1em}p,pre{margin-bottom:1.5em}body,p,pre{font-size:1rem;line-height:1.6}p,pre{margin-bottom:1.36rem}@media (min-width:600px){h1{font-size:4.3978rem;line-height:4.4rem}h4{font-size:1.5554rem;line-height:1.76rem}body,p,pre{font-size:1.1rem;line-height:1.6}h1,h4,p,pre{margin-bottom:1.496rem}}@media (min-width:1200px){h1{font-size:6.0756rem;line-height:6.72rem}h4{font-size:1.8rem;line-height:1.92rem}body,p,pre{font-size:1.2rem;line-height:1.6}h1,h4,p,pre{margin-bottom:1.632rem}}code,pre{overflow-x:auto}pre{font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace}pre code:not([class]){padding:1.5em;overflow-x:scroll}button,code{border-radius:.3em}code{color:#e2777a;padding:0 .3em;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:90%;background:#2d2d2d}h1,h4,html{font-family:Inter UI,sans-serif}h4{font-style:italic}a:hover{text-decoration:underline}@supports (font-variation-settings:normal){html{font-family:Inter UI var alt,sans-serif}}form{padding:1.5em 1.5em 0;border:.2rem solid #202020;margin-bottom:1.5em}button{max-width:100%;background:#f2f2f2;color:#191919;cursor:pointer;display:inline-block;padding:.75em 1.5em;text-align:center;margin:0 .75em 1.5em 0}form>:not(fieldset){margin-right:.75em}button:hover{background:#d9d9d9;color:#000}button:not([disabled]){background:#f9c412;color:#181818;background:var(--primary)}button:not([disabled]):hover{background:#ba9005;color:#000;background:var(--primary-dark)}*{border:0;box-sizing:border-box}body,header nav a{font-family:Inter UI,sans-serif}body{background:#181818;color:#eee}header{padding:4.5em 1.5em 3em;width:37.5em;margin:0 auto;text-align:center;max-width:100%;display:flex;align-items:center;flex-direction:column}header p{margin-top:0}header nav h1{float:left;font-size:inherit;line-height:inherit;margin:0;text-align:left}header nav a{font-weight:700;text-decoration:none;color:#181818;margin-left:1.5em}header nav a:first-of-type{margin-left:auto}header nav a:last-of-type{margin-right:1.5em}main{max-width:70rem;margin:0 auto;border-top:.5px solid #ccc}footer{background:rgba(0,0,0,.8);color:#fff;padding:3em;text-align:center}footer>*{margin:1.5em}footer nav a img{vertical-align:middle}footer nav,footer p{font-size:90%}article{max-width:100%;padding:1.5em;width:37.5em;margin:0 auto}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;background:#2d2d2d}.token.comment,.token.doctype{color:#999}.token.punctuation{color:#ccc}.token.boolean,.token.function{color:#f08d49}.token.class-name,.token.property{color:#f8c555}.token.builtin,.token.keyword{color:#cc99cd}.token.string{color:#7ec699}.token.operator,.token.url{color:#67cdcc}.token.inserted{color:green}</style></head><body><header><nav><div id="nav"><h1><a href="/" title="Homepage">Fares' Blog</a></h1><a href="/about/">About</a></div><div id="reading-progress" aria-hidden="true"></div></nav><h1>Django Filtering</h1><aside>4 min read.</aside><dialog id="message"></dialog></header><main><article><h4 id="problem">Problem <a href="#problem" class="direct-link">#</a></h4><p>If you make a webapp, you will need someday or another to give filtering options to your frontend coworkers. In Django it is pretty simple to add filtering to a <code>query_set: e.g (Item.objects.filter(name='Graphic Card'))</code></p><p>Although, I found optional filtering was annoying, I could've used the <code>Item.objects.filter(name__startswith='')</code> when there's no filter given but this is not nice because if you have 10 different filters you will still need to handle integers and pass all the filters even the empty ones to your query.</p><h4 id="solution">Solution <a href="#solution" class="direct-link">#</a></h4><p>Let's handle the use case of a <code>/GET /items?name__startswith=Grap&amp;price_gte=300&amp;price__lte=700</code> which should return all items that start with <code>Grap</code> and price range from <code>300</code> and <code>700</code></p><p>So your request will trigger the viewset <code>ItemViewSet</code> which contains the default function <code>list</code> which returns the the elements in <code>self.get_queryset()</code> which the default is all elements (At least for me when I generated the sample ViewSet)</p><p>Here's what I found:</p><pre class="language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">ListModelMixin</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span><br>    <span class="token string triple-quoted-string">"""<br>    List a queryset.<br>    """</span><br>    <span class="token keyword">def</span> <span class="token function">list</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span><br>        queryset <span class="token operator">=</span> self<span class="token punctuation">.</span>filter_queryset<span class="token punctuation">(</span>self<span class="token punctuation">.</span>get_queryset<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><br>        serializer <span class="token operator">=</span> self<span class="token punctuation">.</span>get_serializer<span class="token punctuation">(</span>queryset<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><br>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span></code></pre><p>To modify the behaviour we need to override the <code>get_queryset()</code>, I am not sure if we should override the <code>def list()</code> function but it looked to me that if I did that, the <code>get_queryset()</code> will return everything and then we filter in the backend, which I don't want.</p><p>Now back to our sheeps, to make our URL work we can make a function that will dynamically generate our query parameters like this:</p><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Q<br><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><br><br><br><span class="token comment"># `/GET /items?name__startswith=Grap&amp;price_gte=300&amp;price__lte=700`</span><br><span class="token keyword">def</span> <span class="token function">get_queryset</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span><br><br>    filters <span class="token operator">=</span> <span class="token punctuation">{</span><br>                <span class="token string">'name__startswith'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'name__startswith '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>                <span class="token string">'price__gte'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'price_gte '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>                <span class="token string">'price__lte'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'price__lte'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>              <span class="token punctuation">}</span><br><br>    <span class="token keyword">def</span> <span class="token function">queries</span><span class="token punctuation">(</span>filters<span class="token punctuation">)</span><span class="token punctuation">:</span><br>        <span class="token keyword">return</span> <span class="token punctuation">[</span>Q<span class="token punctuation">(</span><span class="token operator">**</span><span class="token punctuation">{</span>k<span class="token punctuation">:</span> v<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> filters<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> v<span class="token punctuation">]</span><br><br>    <span class="token keyword">return</span> Item<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token operator">*</span>queries<span class="token punctuation">(</span>filters<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>First, we fetch the 3 query sets and put them in a dictionary with the keys <code>name__startswith</code>, <code>price_gte</code>, <code>price__lte</code>, if they are not there we give the default value '' (which means False).</p><p>Second, our queries function will generate an array of Queries <code>Q</code> of column name <code>k</code> (the key of the dictionary <code>filters.items()</code>) and the filter condition <code>v</code> (the value of <code>filters.items()</code>), but only <code>if v</code> (translates to <code>if True</code>, remember <code>''</code> means False). The function Q takes as arguments named variables, of the form <code>Q(name__startswith='Gra')</code> (named arguments) and this is why I used a dictionary with unpacking, a bit like **kwargs: you can see some doc about that <a href="http://book.pythontips.com/en/latest/args_and_kwargs.html">here</a>.</p><p>Third we pass the filters we generated earlier to the function we just created, which will return an array of Queries, but our <code>Item.objects.filter</code> takes multiple queries as arguments and not an array of queries, so again we need to unpack the unnamed variables like this: <code>*queries(filters)</code>, this will look like this after unpacking: <code>Item.objects.filter(Q1, Q2, Q3)</code> where <code>Q1=Q(name__startswith='Gra'), Q2=Q(price_gte=300), Q3=Q(price__lte=700)</code>.</p><p>Finally, you can add more complex filtering like <code>category__in=[1,2,3]</code> (where 1 2 and 3 are category ids). To do this you just need to parse your array in the filters level like this:</p><pre class="language-python"><code class="language-python"><span class="token punctuation">{</span><br>    <span class="token string">'category__in'</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'category__in'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span> <span class="token keyword">if</span> c<span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre><p>This will split your query parameter <code>category__in=1,2,3</code> into an array <code>[1,2,3]</code>, again if the array is empty, the <code>queries(filters)</code> function will evaluate <code>[]</code> to <code>False</code></p><p>Happy Pythoning!</p><p><em>PS: If you find an issue or a way to improve this article, please open an issue <a href="https://github.com/serafss2/serafss2.github.io/issues">here</a>.</em></p><p><em>Note1: Try these 'Falsy' variables</em></p><pre class="language-python"><code class="language-python"><span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'List is empty'</span><span class="token punctuation">)</span><br><span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token string">''</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'String is empty'</span><span class="token punctuation">)</span></code></pre><p><em>Note2: You could also take all query parameters and directly build your dictionary, something like:</em></p><pre class="language-python"><code class="language-python"><span class="token punctuation">[</span>Q<span class="token punctuation">(</span><span class="token operator">**</span><span class="token punctuation">{</span>k<span class="token punctuation">:</span> v<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>GET<span class="token punctuation">]</span></code></pre><p><em>You could also make a function that would translate <code>__in</code> to splitting the value, etc. I didn't try something like this yet but if I find the need I would update this article, if you do it, feel free to contribute</em></p><h1>🙏🙏🙏</h1><p>Since you've made it this far, <a href="https://serafdev.github.io/posts/2019-02-17-Django-filtering-with-query-parameters/" on-click="share">sharing</a> this article on your favorite social media network would be highly appreciated 💖! For feedback, please <a href="https://twitter.com/@serafdev" rel="noopener" target="_blank">ping me on Twitter.</a></p><share-widget><button aria-label="Share" href="https://serafdev.github.io/posts/2019-02-17-Django-filtering-with-query-parameters/" on-click="share"><div></div></button></share-widget><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "Django Filtering",
  "image": [],
  "author": "Fares B.", 
  "genre": "Insert a schema.org genre", 
  "publisher": {
    "@type": "Organization",
    "name": "Seraf Development.",
    "logo": {
      "@type": "ImageObject",
      "url": "/img/favicon/favicon-192x192.png?hash=2089033c93"
    }
  },
  "url": "https://serafdev.github.io/posts/2019-02-17-Django-filtering-with-query-parameters/",
  "mainEntityOfPage": "https://serafdev.github.io/posts/2019-02-17-Django-filtering-with-query-parameters/",
  "datePublished": "2019-02-17",
  "dateModified": "2020-10-26",
  "description": "Problem # If you make a webapp, you will need someday or another to give filtering options to your frontend coworkers. In Django it is..."
}</script><p>Published <time datetime="2019-02-17">17 Feb 2019</time></p></article></main><footer><a href="/about/">Fares B.</a></footer></body></html>